(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[905],{7541:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/questionnaire",function(){return r(8830)}])},6874:function(e,t,r){"use strict";var l=r(5893),i=r(9008),s=r.n(i),a=r(7294),n=r(1163),c=r(5610);let o=e=>{let{title:t,children:r,isSetUpOGP:i=!0,isTitleHidden:o=!1,isAuthPageHidden:u=!1,loading:d=!1}=e,{push:x}=(0,n.useRouter)();return(0,a.useEffect)(()=>{u&&!d&&x("/signin")},[u,d,x]),(0,l.jsxs)(l.Fragment,{children:[i&&(0,l.jsxs)(s(),{children:[(0,l.jsx)("title",{children:t}),(0,l.jsx)("meta",{property:"og:title",content:t})]}),(0,l.jsxs)("div",{className:"w-[100vw] flex flex-col items-center",children:[!o&&(0,l.jsx)("h1",{className:"text-2xl my-6 font-bold w-[100vw] text-center",children:t}),d&&(0,l.jsx)(c.$,{thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500",size:"xl"}),(!u||!d)&&r]})]})};t.Z=o},9695:function(e,t,r){"use strict";var l=r(5893),i=r(3234),s=r(979),a=r(9135),n=r(7741),c=r(9198),o=r.n(c);r(5828);var u=r(9828),d=r(7294);let x=e=>{let{questionnaire:t,setQuestionnaire:r,onSubmit:c,inputError:x,defaultValue:p}=e;return(0,d.useEffect)(()=>{p&&r({...t,...p})},[p]),(0,l.jsxs)("form",{onSubmit:c,className:"p-6 text-left border w-80 md:w-96 rounded-xl shadow-xl bg-white flex flex-col",children:[(0,l.jsxs)(i.NI,{children:[(0,l.jsx)(i.lX,{children:"タイトル"}),(0,l.jsx)(s.II,{type:"text",value:t.title,placeholder:"アンケートタイトル",onChange:e=>r({...t,title:e.target.value})})]}),(0,l.jsxs)(i.NI,{children:[(0,l.jsx)(i.lX,{className:"pt-3",children:"有効期限"}),(0,l.jsx)(o(),{selected:t.expiry?t.expiry.toDate():null,onChange:e=>r({...t,expiry:e?u.EK.fromDate(e):null}),placeholderText:"有効期限",className:"border border-gray-200 rounded-md w-[270px] md:w-[20.8rem] py-2 pl-2"})]}),(0,l.jsxs)(i.NI,{children:[(0,l.jsx)(i.lX,{className:"pt-3",children:"URL"}),(0,l.jsx)(s.II,{type:"text",placeholder:"googleフォームURL(回答用)",value:t.url,onChange:e=>r({...t,url:e.target.value})})]}),(0,l.jsxs)(i.NI,{children:[(0,l.jsx)(i.lX,{className:"pt-3",children:"URL"}),(0,l.jsx)(s.II,{type:"text",placeholder:"googleフォームURL(編集用)",value:t.editUrl,onChange:e=>r({...t,editUrl:e.target.value})})]}),(0,l.jsxs)(i.NI,{children:[(0,l.jsx)(i.lX,{className:"pt-3",children:"有効"}),(0,l.jsx)(a.XZ,{isChecked:t.active,onChange:e=>r({...t,active:e.target.checked})}),t.active&&(0,l.jsx)("p",{className:"text-gray-500 text-sm",children:"※他のアンケートを無効にします"})]}),(0,l.jsx)(n.zx,{type:"submit",px:16,py:0,colorScheme:"blue",className:"mt-6 self-center",size:"sm",children:"投稿"}),x&&(0,l.jsx)("p",{className:"mt-6 text-red-500",children:x})]})};t.Z=x},6799:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var l=r(9828);let i=async e=>{var t;let r=(0,l.ad)(),i=(0,l.JU)(r,"questionnaires",e);await (0,l.r7)(i,{active:!0});let s=(0,l.hJ)(r,"questionnaires"),a=await (0,l.QT)(i),n=null===(t=a.data())||void 0===t?void 0:t.userId,c=(0,l.IO)(s,(0,l.ar)("userId","==",n)),o=await (0,l.PL)(c);o.forEach(t=>{t.id!==e&&(0,l.r7)(t.ref,{active:!1})})}},5593:function(e,t,r){"use strict";r.d(t,{R:function(){return s}});var l=r(9828),i=r(7294);let s=()=>{let e=(0,i.useCallback)(async(e,t,r,i,s)=>{let a;let n=(0,l.ad)(),c=new Date,o={createdTime:c,updatedTime:c};if(r?await (0,l.pl)(a=(0,l.JU)(n,e,r),{...t,updatedTime:c},{merge:!0}):a=await (0,l.ET)((0,l.hJ)(n,e),{...o,...t}),i&&s){let u=(0,l.hJ)(a,i);for(let d of s)await (0,l.ET)(u,{...o,...d})}return a.id},[]);return e}},8830:function(e,t,r){"use strict";r.r(t),r.d(t,{Page:function(){return v},default:function(){return w}});var l=r(5893),i=r(7294),s=r(4221);r(5828),r(2490);var a=r(1734),n=r(1163),c=r(6799);let o=e=>""===e?"タイトルを入力してください":"",u=e=>null===e?"有効期限を入力してください":"",d=(e,t)=>""===e?"URL(".concat(t,")を入力してください"):!e.match("回答用"===t?/^https:\/\/docs.google.com\/forms\/d\/e\/.+\/viewform$/:/^https:\/\/docs.google.com\/forms\/d\/.+\/edit$/)&&e.split("/")[6]?"URL(".concat(t,")が正しくありません"):"",x=e=>o(e.title)||u(e.expiry)||d(e.url,"回答用")||d(e.editUrl,"編集用");var p=r(6874),h=r(5593);let m=e=>{let t=e.split("/")[5];return t||null};var f=r(9695);let v=()=>{let[e,t]=(0,i.useState)({title:"",url:"",editUrl:"",expiry:null,active:!1}),[r,o]=(0,i.useState)(""),{user:u}=(0,a.E)(),d=(0,n.useRouter)(),v=(0,s.pm)(),w=(0,h.R)(),j=async t=>{t.preventDefault();let r=x(e);if(""!==r){o(r);return}let l=await m(e.editUrl);if(!u||!l){v({title:"エラーが発生しました。",status:"error",position:"top"});return}try{await g(u.uid,l),await (0,c.Z)(l),y(),v({title:"投稿しました。",status:"success",position:"top"}),d.push("/doc/SetUpAndHelp")}catch(i){console.error("Firebase Error",i),v({title:"エラーが発生しました。",status:"error",position:"top"})}},g=async(t,r)=>{await w("questionnaires",{title:e.title,expiry:e.expiry,url:e.url,editUrl:e.editUrl,userId:t,createdTime:new Date,updatedTime:new Date,isAuthenticated:!1},r)},y=()=>{t({title:"",url:"",editUrl:"",expiry:null,active:!1}),o("")};return(0,l.jsx)(p.Z,{title:"アンケート投稿",isAuthPageHidden:!u,children:(0,l.jsx)("div",{className:"flex flex-col items-center py-2",children:(0,l.jsx)(f.Z,{questionnaire:e,setQuestionnaire:t,onSubmit:j,inputError:r})})})};var w=v}},function(e){e.O(0,[45,74,774,888,179],function(){return e(e.s=7541)}),_N_E=e.O()}]);