(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[29],{6608:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/questionnaire/edit/[id]",function(){return s(2158)}])},6874:function(e,t,s){"use strict";var l=s(5893),r=s(9008),i=s.n(r),a=s(7294),n=s(1163),c=s(5610);let u=e=>{let{title:t,children:s,isSetUpOGP:r=!0,isTitleHidden:u=!1,isAuthPageHidden:o=!1,loading:d=!1}=e,{push:x}=(0,n.useRouter)();return(0,a.useEffect)(()=>{o&&!d&&x("/signin")},[o,d,x]),(0,l.jsxs)(l.Fragment,{children:[r&&(0,l.jsxs)(i(),{children:[(0,l.jsx)("title",{children:t}),(0,l.jsx)("meta",{property:"og:title",content:t})]}),(0,l.jsxs)("div",{className:"w-[100vw] flex flex-col items-center",children:[!u&&(0,l.jsx)("h1",{className:"text-2xl my-6 font-bold w-[100vw] text-center",children:t}),d&&(0,l.jsx)(c.$,{thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500",size:"xl"}),(!o||!d)&&s]})]})};t.Z=u},9695:function(e,t,s){"use strict";var l=s(5893),r=s(3234),i=s(979),a=s(9135),n=s(7741),c=s(9198),u=s.n(c);s(5828);var o=s(9828),d=s(7294);let x=e=>{let{questionnaire:t,setQuestionnaire:s,onSubmit:c,inputError:x,defaultValue:h}=e;return(0,d.useEffect)(()=>{h&&s({...t,...h})},[h]),(0,l.jsxs)("form",{onSubmit:c,className:"p-6 text-left border w-80 md:w-96 rounded-xl shadow-xl bg-white flex flex-col",children:[(0,l.jsxs)(r.NI,{children:[(0,l.jsx)(r.lX,{children:"タイトル"}),(0,l.jsx)(i.II,{type:"text",value:t.title,placeholder:"アンケートタイトル",onChange:e=>s({...t,title:e.target.value})})]}),(0,l.jsxs)(r.NI,{children:[(0,l.jsx)(r.lX,{className:"pt-3",children:"有効期限"}),(0,l.jsx)(u(),{selected:t.expiry?t.expiry.toDate():null,onChange:e=>s({...t,expiry:e?o.EK.fromDate(e):null}),placeholderText:"有効期限",className:"border border-gray-200 rounded-md w-[270px] md:w-[20.8rem] py-2 pl-2"})]}),(0,l.jsxs)(r.NI,{children:[(0,l.jsx)(r.lX,{className:"pt-3",children:"URL"}),(0,l.jsx)(i.II,{type:"text",placeholder:"googleフォームURL(回答用)",value:t.url,onChange:e=>s({...t,url:e.target.value})})]}),(0,l.jsxs)(r.NI,{children:[(0,l.jsx)(r.lX,{className:"pt-3",children:"URL"}),(0,l.jsx)(i.II,{type:"text",placeholder:"googleフォームURL(編集用)",value:t.editUrl,onChange:e=>s({...t,editUrl:e.target.value})})]}),(0,l.jsxs)(r.NI,{children:[(0,l.jsx)(r.lX,{className:"pt-3",children:"有効"}),(0,l.jsx)(a.XZ,{isChecked:t.active,onChange:e=>s({...t,active:e.target.checked})}),t.active&&(0,l.jsx)("p",{className:"text-gray-500 text-sm",children:"※他のアンケートを無効にします"})]}),(0,l.jsx)(n.zx,{type:"submit",px:16,py:0,colorScheme:"blue",className:"mt-6 self-center",size:"sm",children:"投稿"}),x&&(0,l.jsx)("p",{className:"mt-6 text-red-500",children:x})]})};t.Z=x},6799:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var l=s(9828);let r=async e=>{var t;let s=(0,l.ad)(),r=(0,l.JU)(s,"questionnaires",e);await (0,l.r7)(r,{active:!0});let i=(0,l.hJ)(s,"questionnaires"),a=await (0,l.QT)(r),n=null===(t=a.data())||void 0===t?void 0:t.userId,c=(0,l.IO)(i,(0,l.ar)("userId","==",n)),u=await (0,l.PL)(c);u.forEach(t=>{t.id!==e&&(0,l.r7)(t.ref,{active:!1})})}},2158:function(e,t,s){"use strict";s.r(t),s.d(t,{Page:function(){return d}});var l=s(5893),r=s(7294),i=s(1163),a=s(8036),n=s(4221);s(5828),s(2490);var c=s(6799),u=s(9695),o=s(6874);let d=()=>{let[e,t]=(0,r.useState)({title:"",url:"",editUrl:"",expiry:null,active:!1}),[s,d]=(0,r.useState)(""),x=(0,i.useRouter)(),{id:h}=x.query,p=(0,n.pm)();(0,r.useEffect)(()=>{let e=async()=>{let e=(0,a.ad)();if(!h)return;let s=(0,a.JU)(e,"questionnaires",h),l=await (0,a.QT)(s);l.exists()&&t(l.data())};e()},[h]);let m=async t=>{if(t.preventDefault(),f())try{let s=(0,a.ad)(),l=(0,a.JU)(s,"questionnaires",h);h&&(await (0,a.r7)(l,{title:e.title,expiry:e.expiry,url:e.url,updatedTime:new Date}).then(()=>{(0,c.Z)(h)}),x.push("/")),d(""),p({title:"更新しました。",status:"success",position:"top"})}catch(r){p({title:"エラーが発生しました。",status:"error",position:"top"})}},f=()=>""===e.title?(d("タイトルを入力してください"),!1):""===e.url?(d("URLを入力してください"),!1):e.url.match(/^https:\/\/docs.google.com\/forms\/d\/e\/.+\/viewform$/)?null!==e.expiry||(d("有効期限を入力してください"),!1):(d("URLが正しくありません"),!1);return(0,l.jsx)(o.Z,{title:"アンケート編集",children:(0,l.jsxs)("div",{className:"flex flex-col items-center py-2",children:[(0,l.jsx)(u.Z,{questionnaire:e,setQuestionnaire:t,onSubmit:m,inputError:s,defaultValue:e}),(0,l.jsx)("p",{className:"mt-6 text-red-500",children:s})]})})};t.default=d}},function(e){e.O(0,[45,74,774,888,179],function(){return e(e.s=6608)}),_N_E=e.O()}]);